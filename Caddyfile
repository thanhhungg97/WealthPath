# WealthPath Caddy Configuration
#
# Environment variables:
#   DOMAIN    - Domain name (e.g., wealthpath.duckdns.org)
#   ACME_CA   - Optional: ACME CA URL for ZeroSSL
#   ACME_EMAIL - Optional: Email for certificate registration

{
    # Use ZeroSSL if ACME_CA is set
    acme_ca {$ACME_CA:}
    email {$ACME_EMAIL:}
}

# Main app - wealthpath.duckdns.org
{$DOMAIN:localhost} {
    # API routes to backend
    reverse_proxy /api/* backend:8080
    
    # Everything else to frontend
    reverse_proxy /* frontend:3000
    
    # Logging
    log {
        output stdout
        format console
    }
    
    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
        -Server
    }
    
    # Enable compression
    encode gzip zstd
}

# Admin panel - admin.wealthpath.duckdns.org
admin.{$DOMAIN:localhost} {
    reverse_proxy admin:8081
    
    # Logging
    log {
        output stdout
        format console
    }
    
    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
        -Server
    }
    
    # Enable compression
    encode gzip zstd
}
